---
alwaysApply: true
description: SubZilla project structure and architecture guide
---

# SubZilla Project Structure & Architecture ğŸ—ï¸

SubZilla is a **monorepo subtitle converter** built with **TypeScript**, **Yarn Workspaces**, and follows **SOLID, YAGNI, KISS, and DRY** principles.

## ğŸ“ Monorepo Structure

```
subzilla/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ types/            # @subzilla/types - Foundation types & validation
â”‚   â”œâ”€â”€ core/             # @subzilla/core - Business logic & processing
â”‚   â””â”€â”€ cli/              # @subzilla/cli - Command-line interface
â”œâ”€â”€ examples/config/      # Configuration examples
â”œâ”€â”€ [package.json](mdc:package.json)          # Workspace root
â””â”€â”€ [tsconfig.json](mdc:tsconfig.json)        # TypeScript project references
```

## ğŸ”— Package Dependencies

```
@subzilla/cli
    â”œâ”€â”€ @subzilla/core
    â”‚   â””â”€â”€ @subzilla/types
    â””â”€â”€ @subzilla/types
```

- **@subzilla/types**: Zero-dependency foundation with interfaces and Zod schemas
- **@subzilla/core**: Core subtitle processing services (depends on types)
- **@subzilla/cli**: User interface layer (depends on core and types)

## ğŸ¯ Key Architecture Principles

### SOLID Principles

- **Single Responsibility**: Each class has one clear purpose
- **Open/Closed**: Extensible through interfaces (e.g., `IOutputStrategy`)
- **Liskov Substitution**: Strategy pattern implementations
- **Interface Segregation**: Focused, specific interfaces
- **Dependency Inversion**: Depend on abstractions, not concretions

### Design Patterns

- **Strategy Pattern**: Output strategies ([SuffixOutputStrategy](mdc:packages/core/src/utils/SuffixOutputStrategy.ts), [OverwriteOutputStrategy](mdc:packages/core/src/utils/OverwriteOutputStrategy.ts))
- **Service Layer**: Core services ([SubtitleProcessor](mdc:packages/core/src/SubtitleProcessor.ts), [BatchProcessor](mdc:packages/core/src/BatchProcessor.ts))
- **Configuration Management**: [ConfigManager](mdc:packages/core/src/ConfigManager.ts) with multiple sources

## ğŸ“¦ Package Structure

### Types Package ([packages/types/](mdc:packages/types/))

```
src/
â”œâ”€â”€ cli/          # CLI-related interfaces
â”œâ”€â”€ core/         # Core functionality types
â”œâ”€â”€ index.ts      # Main exports
â””â”€â”€ validation.ts # Zod schemas
```

### Core Package ([packages/core/](mdc:packages/core/))

```
src/
â”œâ”€â”€ *.ts          # Main services (SubtitleProcessor, BatchProcessor, etc.)
â”œâ”€â”€ utils/        # Output strategies and utilities
â””â”€â”€ index.ts      # Package exports
```

### CLI Package ([packages/cli/](mdc:packages/cli/))

```
src/
â”œâ”€â”€ commands/     # Command implementations
â”œâ”€â”€ constants/    # Shared CLI options
â”œâ”€â”€ registry/     # Command registration
â”œâ”€â”€ utils/        # CLI utilities
â””â”€â”€ main.ts       # Entry point
```

## ğŸ”§ Development Workflow

### Build System

- **TypeScript Project References**: Fast incremental builds
- **Workspace Scripts**: `yarn build`, `yarn dev`, `yarn start`
- **Dependency Order**: Types â†’ Core â†’ CLI

### File Organization

- **Default Exports**: Classes use default exports
- **Named Exports**: Interfaces and types use named exports
- **Barrel Exports**: Each package has `index.ts` for clean imports
- **Cross-Package Imports**: Use workspace references (`@subzilla/types`)

## ğŸ¨ Code Organization Patterns

### Service Classes

```typescript
export default class ServiceName {
    private dependency: DependencyType;

    constructor() {
        this.dependency = new DependencyType();
    }

    public async mainMethod(): Promise<ReturnType> {
        // Implementation
    }
}
```

### Configuration Management

- **YAML Configuration**: `.subzillarc`, `.subzilla.yml`
- **Environment Variables**: `SUBZILLA_*` prefix
- **Precedence**: CLI args > Env vars > Config file > Defaults
- **Validation**: Zod schemas for runtime validation

### Error Handling

- **Graceful Degradation**: Continue processing on non-critical errors
- **Progress Tracking**: Real-time progress bars for batch operations
- **Comprehensive Logging**: Emoji-rich console output with detailed statistics

## ğŸš€ Performance Considerations

- **Parallel Processing**: Batch operations support parallel execution
- **Streaming**: Large file handling with proper memory management
- **Chunked Processing**: Configurable batch sizes
- **Progress Tracking**: Multi-bar progress display for user feedback

When working with this codebase:

1. **Follow the dependency hierarchy** - types â†’ core â†’ cli
2. **Use TypeScript project references** for cross-package imports
3. **Implement new features as services** in the core package
4. **Add CLI commands** in the cli package with proper registration
5. **Define interfaces first** in the types package
6. **Follow the established patterns** for consistency and maintainability
